
########
# Misc #
########

# trigger focus events
set -g focus-events on

# allow rename
set-option -g allow-rename

# Renumber windows
set-option -g renumber-windows on

# Fix esc delay
set -s escape-time 0

# Enable mouse control (clickable windows, panes, resizable panes)
set -g mouse on

# enable vi mode
set -g status-keys vi
set -g status-keys emacs

#################
# window titles #
#################
set -g set-titles on
set -g set-titles-string '#S:#I - #T'
set -g automatic-rename

################
# key bindings #
################

# reload config file 
bind r source-file ~/.tmux.conf

# remap prefix from 'C-b' to 'C-a'
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Vim-like pane navigation and resizing.
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R
bind-key -r H resize-pane -L 6
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

# Visual mode
bind -T copy-mode-vi v send-keys -X begin-selection 
bind -T copy-mode-vi i send-keys -X cancel 
bind -T copy-mode-vi 'C-q' send-keys -X begin-selection \; send-keys -X rectangle-toggle
bind -T copy-mode-vi '^[' send-keys -X clear-selection

# Bindings 
## NOT WORKING
bind-key -n C-S-Enter new-window
# bind-key -n C-/ split-window -h -c "#{pane_current_path}"
# bind -n C-Escape copy-mode 
# bind-key -n C-` run "$TMUX_BIN/switch_session_detached '#{session_id}'" 

# preview and switch session
bind-key -n C-Tab run "$TMUX_BIN/switch_session '#{session_id}'" 

bind-key -n C-S-T new-window

bind-key -n C-S-J next-window

bind-key -n C-S-K previous-window

bind-key -n C-S-W kill-pane 
bind-key -n C-S-Q kill-pane
bind-key -n C-S-Bspace kill-pane 

# preview and move window to the current session
bind-key -n C-S-P run "$TMUX_BIN/grab_window '#{session_id}'" 

bind-key -n C-S-Space if -F '#{==:#{window_panes},1}' \
                    'split-window -v -l15%' \
                    'if -F "#{==:#{window_zoomed_flag},1}" \
                      "resize-pane -Z ; resize-pane -y85% ; select-pane -D " \
                      "select-pane -U ; if-shell \" [ #{pane_at_bottom} -eq 0  -a #{window_panes} -lt 3 ] \" \" \
                                           resize-pane -Z \" " '

bind -n C-: select-pane -U

bind-key -n C-- split-window -v -c "#{pane_current_path}"


# preview and switch session (detached ones only)
bind-key -n C-S-M new-window # REMOVE when C-S-Enter gets fixed and uncoment the one below
# bind-key -n C-S-M run "$TMUX_BIN/switch_session_detached '#{session_id}'" 

# preview and switch session (kill the last session)
bind -n C-S-X run "$TMUX_BIN/kill_session '#{session_id}'"

bind -n C-S-L select-pane -R

bind -n C-S-H select-pane -L

bind -n C-S-F resize-pane -Z

bind -n C-S-N copy-mode 

bind -n C-S-B send-keys -t + '[A' Enter

# OLD (using user-keys)
#set -s user-keys[0] "\033[9;5u" # C-Tab
## preview and switch session
#bind-key -n User0 run "$TMUX_BIN/switch_session '#{session_id}'" 

#set -s user-keys[1] "\033[84;6u" # C-S-T
#bind-key -n User1 new-window

#set -s user-keys[2] "\033[13;6u" # C-S-Enter
#bind-key -n User2 new-window

#set -s user-keys[3] "\033[75;6u" # C-S-J
#bind-key -n User3 next-window

#set -s user-keys[4] "\033[74;6u" # C-S-k
#bind-key -n User4 previous-window

#set -s user-keys[5] "\033[87;6u" # C-S-w
#bind-key -n User5 kill-pane 

#set -s user-keys[6] "\033[81;6u" # C-S-q
#bind-key -n User6 kill-pane

#set -s user-keys[7] "\033[80;6u" # C-S-p
## preview and move window to the current session
#bind-key -n User7 run "$TMUX_BIN/grab_window '#{session_id}'" 
## bind-key -n User7 run-shell 'tmux choose-tree -sw -O time -f "##{!=:##{session_id},#{session_id}}" "move-window -s '%%'"'
##choose-tree -sw -O time"move-window -s '%%'"

#set -s user-keys[8] "\033[127;6u" # C-S-Return
#bind-key -n User8 kill-pane 

#set -s user-keys[9] "\033[32;6u" # C-S-Space
#bind-key -n User9 if -F '#{==:#{window_panes},1}' \
#                    'split-window -v -l15%' \
#                    'if -F "#{==:#{window_zoomed_flag},1}" \
#                      "resize-pane -Z ; resize-pane -y85% ; select-pane -D " \
#                      "select-pane -U ; if-shell \" [ #{pane_at_bottom} -eq 0  -a #{window_panes} -lt 3 ] \" \" \
#                                           resize-pane -Z \" " '

#set -s user-keys[10] "\033[96;5u" # C-Grave
## preview and switch session (detached ones only)
#bind-key -n User10 run "$TMUX_BIN/switch_session_detached '#{session_id}'" 
## choose-tree -Zws -O time -f "#{==:#{session_attached},0}" # choose-client

#set -s user-keys[11] "\033[95;6u" # C--
#bind-key -n User11 split-window -v -c "#{pane_current_path}"

#set -s user-keys[12] "\033[124;6u" # C-/
#bind-key -n User12 split-window -h -c "#{pane_current_path}"

#set -s user-keys[13] "\033[77;6u" # C-S-M
## preview and switch session (detached ones only)
#bind-key -n User13 run "$TMUX_BIN/switch_session_detached '#{session_id}'" 

#set -s user-keys[14] "\033[88;6u" # C-S-X
## preview and switch session (kill the last session)
#bind -n User14 run "$TMUX_BIN/kill_session '#{session_id}'"

#set -s user-keys[15] "\033[58;6u" # C-S-:
#bind -n User15 select-pane -U

#set -s user-keys[16] "\033[76;6u" # C-S-L
#bind -n User16 select-pane -R

#set -s user-keys[17] "\033[72;6u" # C-S-H
#bind -n User17 select-pane -L

#set -s user-keys[18] "\033[70;6u" # C-S-F
#bind -n User18 resize-pane -Z

#set -s user-keys[19] "\033[27;5u" # C-Esc
#bind -n User19 copy-mode 

#set -s user-keys[20] "\033[78;6u" # C-S-N
#bind -n User20 copy-mode 

#set -s user-keys[21] "\033[66;6u" # C-S-N
#bind -n User21 send-keys -t + '[A' Enter

#if -F '#{!=:#{window_panes},1}' \
                    'select-pane -U' \
                    
# next pane
# bind -n User15 select-pane -t :.+

bind "q" kill-pane

##############
# status bar #
##############

set -g status 'on'
set -g status-position 'bottom'
set -g status-style bg='colour234'
set -g status-justify 'centre'
set -g status-left-length '100'
set -g status-right-length '100'
set -g message-style fg='colour222',bg='colour238'
set -g message-command-style fg='colour222',bg='colour238'
set -g pane-border-style fg='colour238'
set -g pane-active-border-style fg='colour154'
setw -g window-status-activity-style fg='colour154',bg='colour235',none
setw -g window-status-separator ''
setw -g window-status-style fg='colour121',bg='colour235',none
set -g status-right '#[fg=colour15,bg=colour235] #S '
set -g status-left ''
set-window-option -g window-status-separator '  '
setw -g window-status-format '#[fg=colour15,bg=colour8] #I #[fg=colour15,bg=colour237] #T '
setw -g window-status-current-format '#[fg=colour15,bg=colour27] #I #[fg=colour15,bg=colour33] #{?window_zoomed_flag,[Z] ,}#T '
# pane
set -g pane-active-border-style fg='colour33',bg='default'
set -g pane-border-style fg='colour234',bg='default'


###########
# Plugins #
###########
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'Federico-Ciuffardi/tmux-jump'
set -g @plugin 'ChanderG/tmux-notify'
# set -g @plugin 'Federico-Ciuffardi/tmux-thumbs'

#########
# Mouse #
#########
set -g @emulate-scroll-for-no-mouse-alternate-buffer "on"

########
# Jump #
########
set -g @jump-key 'f'
set -g @jump-bg-color '\e[0m\e[37m'
set -g @jump-fg-color '\e[1m\e[34m'
set -g @jump-keys-position 'off_left'
set -g @jump-contrast 1 

##############
# Sessionist #
##############
set -g @sessionist-alternate 's'

##########
# notify #
##########
set -g @tnotify-verbose 'on'
set -g @tnotify-verbose-msg '#T | compleated!'

##########
# Thumbs #
##########
# set -g @thumbs-key t
# set -g @thumbs-position off_left
# set -g @thumbs-command 'echo -n {} | xclip -selection c'
# set -g @thumbs-upcase-command 'echo -n {} | xclip -selection c'
# set -g @thumbs-fg-color '#FFFFFF'
# set -g @thumbs-bg-color 'black'
# set -g @thumbs-hint-fg-color '#000000'
# set -g @thumbs-hint-bg-color '#FFFFFF'
# set -g @thumbs-select-fg-color '#FFFFFF'
# set -g @thumbs-select-bg-color black
# set -g @thumbs-contrast 1

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'


# copy with mouse (overrides 'nhdaly/tmux-better-mouse-mode' plugin)
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"
